学习笔记

# 浏览器总论

浏览器解析URL最后生成网页的步骤

1. 解析URL请求，发送HTTP/HTTPS请求，获取响应体中的HTML文本
2. 解析HTML文档，生成DOM树
3. 计算CSS样式会匹配到哪些DOM元素，哪些样式会发生叠加或覆盖，生成带样式的DOM树
4. 对所有盒模型(一个元素可能对应多个盒，比如内联元素可能有多个行盒)进行排版，确定页面整体布局
5. 通过渲染把DOM树转化成位图(bitmap)，通过操作系统或硬件驱动的API，把位图最终绘制到屏幕上

# (有限)状态机

每一个状态都是一个机器
- 在每一个机器里，我们可以做计算、存储、输出...
- 所有的这些机器接收的输入是一致的...
- 状态机的每一个机器本身没有状态，类似于一个纯函数(除了入参，不依赖函数外部的其他变量)

每一个机器知道下一个状态
- 每个机器都有确定的下一个状态(Moore)
- 每个机器根据输入决定下一个状态(Mealy)，后续主要介绍这种类型的状态机

Mealy型状态机的简单代码实现:
```
// 每个函数是一个状态
function state(input) //函数参数就是输入
{
  //在函数中，可以自由地编写代码，处理每个状态的逻辑
  return next; //返回值作为下一个状态
}
//调用
while(input) {
  //获取输入
  state = state(input); //把状态机的返回值作为下一个状态
}
```
Mealy状态机可以看作一系列返回状态函数的状态函数
# HTTP请求
## HTTP协议解析
OSI七层模型

|协议分层|实现|
|-|-|
|应用层|HTTP(还包括以下两层)|
|表示层||
|会话层|SSL|
|传输层|TCP|
|网络层|IP|
|数据链路层|4G/5G/Wi-Fi/Ethernet|
|物理层|电磁波/电缆/光缆|

HTTP协议是半双工通信，严格遵守Client先请求Server，返回Response这样的模式
## 实现HTTP请求

1. 设计一个底层库的接口时，可以从它是被怎样使用的角度来考虑，类似于面向接口的思想
2. 底层类库的入参要根据协议、标准、约定来设置默认值和校验参数
3. send函数(发送请求)的设计上要考虑TCP连接的复用，如果当前的客户端代码运行时已经存在这样一个到服务端的连接，可以通过传参的方式去复用它
4. 客户端和服务端都要设置 `数据传输(data)`，`抛出错误(error)`，`数据传输结束(end)` 这些HTTP数据传输过程的状态的回调函数
5. 由于HTTP响应(如果数据足够多的话)是分多个包从服务端返回给客户端的，所以客户端处理响应需要使用状态机这样的流式处理工具
6. HTTP响应体可以通过传输编码(Transfer Encoding)来确定每次传输的body内容的边界，适用于响应内容是动态生成的，直到最后才能确定 Content-Length的情况